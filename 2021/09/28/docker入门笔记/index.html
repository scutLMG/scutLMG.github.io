<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>docker入门笔记 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="docker 的入门笔记。时至今日，容器化技术已经不是什么新鲜东西了，docker 作为开源的应用容器引擎，易于部署，使用方便，一次打包，开箱即用，是值得学习一下的。不求精通，会用就够，记记流水帐。">
<meta property="og:type" content="article">
<meta property="og:title" content="docker入门笔记">
<meta property="og:url" content="http://example.com/2021/09/28/docker%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="docker 的入门笔记。时至今日，容器化技术已经不是什么新鲜东西了，docker 作为开源的应用容器引擎，易于部署，使用方便，一次打包，开箱即用，是值得学习一下的。不求精通，会用就够，记记流水帐。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-09-28T00:00:00.000Z">
<meta property="article:modified_time" content="2023-02-23T18:59:23.717Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-docker入门笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/09/28/docker%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2021-09-28T00:00:00.000Z" itemprop="datePublished">2021-09-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cs/">cs</a>►<a class="article-category-link" href="/categories/cs/docker/">docker</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      docker入门笔记
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>docker 的入门笔记。时至今日，容器化技术已经不是什么新鲜东西了，docker 作为开源的应用容器引擎，易于部署，使用方便，一次打包，开箱即用，是值得学习一下的。不求精通，会用就够，记记流水帐。</p>
<span id="more"></span>

<h2 id="docker-介绍"><a href="#docker-介绍" class="headerlink" title="docker 介绍"></a>docker 介绍</h2><p>容器化技术已经发展应用了很多年了，这里只简单记录一下 docker 。docker 早期使用的是 Linux 的 LXC 容器技术，而后转为自研的开源 runc 。相比于虚拟机，交付快，消耗低，管理方便。</p>
<h3 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h3><p>宿主机内运行了很多的容器，每个容器都要有类似于虚拟机一样的相互隔离的运行空间，但是容器技术是在一个进程内实现运行指定服务的运行环境，并且还可以保护宿主机内核不受其他进程的干扰和影响，如文件系统空间、网络空间、进程空间等，docker 是通过 Namespace 技术实现隔离的。</p>
<p>如 MNT Namespace 提供磁盘挂载点和文件系统的隔离能力，在容器里面是不能访问宿主机的资源，宿主机是使用了chroot技术把容器锁定到一个指定的运行目录里面。在宿主机里启动不同环境的容器，检查运行目录和内核就知道，共享内核但限制了运行目录。</p>
<p>PID Namespace：在每个容器内，同 Linux 系统一样，有 PID 为1的进程作为进程的父进程，PID Namespace 则是实现容器间进程隔离的技术（编号重复，主进程生成、子进程回收）如在宿主机中，父进程1下有debian容器， pid 为5777，容器内的父进程也是 pid 1，但对宿主机而言，debian容器的父进程的 pid 是5788。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemd(1)─┬─ModemManager(969)─┬─&#123;ModemManager&#125;(991)</span><br><span class="line">           │                   └─&#123;ModemManager&#125;(998)</span><br><span class="line">           ├─colord(1681)─┬─&#123;colord&#125;(1690)</span><br><span class="line">           │              └─&#123;colord&#125;(1701)</span><br><span class="line">           ├─containerd(992)─┬─&#123;containerd&#125;(1029)</span><br><span class="line">           │                 ├─&#123;containerd&#125;(1030)</span><br><span class="line">           │                 ├─&#123;containerd&#125;(1107)</span><br><span class="line">           │                 ├─&#123;containerd&#125;(1114)</span><br><span class="line">           │                 └─&#123;containerd&#125;(5705)</span><br></pre></td></tr></table></figure>

<p>可以使用 <code>top</code> 、<code>ps -ef | grep [process]</code> 、<code>ps -ef | grep [PID]</code> 等来在宿主机、容器内进行 PID 追踪验证。</p>
<p>还有 IPC 、UTS、Net、User 等 Namespace 技术，以后再写吧。</p>
<h2 id="docker-组成"><a href="#docker-组成" class="headerlink" title="docker 组成"></a>docker 组成</h2><p>docker 由主机、服务端、客户端、仓库、镜像、容器等组成。</p>
<ul>
<li>Docker 主机(Host)：一个物理机或虚拟机，用于运行Docker服务进程和容器，也称为宿主机，node节点</li>
<li>Docker 服务端(Server)：Docker守护进程，运行docker容器</li>
<li>Docker 客户端(Client)：客户端使用docker 命令或其他工具调用docker API</li>
<li>Docker 镜像(Images)：镜像可以理解为创建实例使用的模板</li>
<li>Docker 容器(Container)：容器是从镜像生成对外提供服务的一个或一组服务</li>
</ul>
<h2 id="docker-安装"><a href="#docker-安装" class="headerlink" title="docker 安装"></a>docker 安装</h2><p>以 ubuntu 为例，其他 Linux 发行版也差不多，出错就看文档。Windows 下的 docker 安装直接下载一个包即可，还带桌面，实在没什么好说的。</p>
<ul>
<li>卸载老版本，首次可跳过。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure>

<ul>
<li>更新并允许 apt 通过 HTTPS 使用存储库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install \</span><br><span class="line">   ca-certificates \</span><br><span class="line">   curl \</span><br><span class="line">   gnupg \</span><br><span class="line">   lsb-release</span><br></pre></td></tr></table></figure>

<ul>
<li>d添加官方密钥</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br></pre></td></tr></table></figure>

<ul>
<li>设置存储库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> \</span><br><span class="line"> <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string"> <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure>

<ul>
<li>安装稳定版</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>

<ul>
<li>验证安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<h2 id="命令帮助"><a href="#命令帮助" class="headerlink" title="命令帮助"></a>命令帮助</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">man docker</span><br><span class="line">docker --help</span><br><span class="line">docker COMMAND --help</span><br><span class="line">man docker -COMMAND</span><br><span class="line"></span><br><span class="line">docker version</span><br><span class="line">docker info</span><br><span class="line">docker search</span><br><span class="line">docker pull</span><br><span class="line">docker run</span><br><span class="line">docker ps</span><br><span class="line">docker rm</span><br><span class="line">docker logs</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Usage:  docker image COMMAND</span><br><span class="line"></span><br><span class="line">Manage images</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  history     Show the history of an image</span><br><span class="line">  import      Import the contents from a tarball to create a filesystem image</span><br><span class="line">  inspect     Display detailed information on one or more images</span><br><span class="line">  load        Load an image from a tar archive or STDIN</span><br><span class="line">  ls          List images</span><br><span class="line">  prune       Remove unused images</span><br><span class="line">  pull        Pull an image or a repository from a registry</span><br><span class="line">  push        Push an image or a repository to a registry</span><br><span class="line">  rm          Remove one or more images</span><br><span class="line">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line"></span><br><span class="line">Run &#x27;docker image COMMAND --help&#x27; for more information on a command.</span><br></pre></td></tr></table></figure>

<p>列出的都是比较常用的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker image ls								#和 docker images 一样</span><br><span class="line">docker search [image]</span><br><span class="line">docker pull [image]</span><br><span class="line">docker run -it ubuntu:20.04 /bin/bash		#i交互操作，t终端，/bin/bash 进入交互式shell</span><br><span class="line">docker commit</span><br></pre></td></tr></table></figure>



<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker start &lt;<span class="built_in">id</span>&gt;</span><br><span class="line">docker run -d</span><br><span class="line">docker stop &lt;<span class="built_in">id</span>&gt;</span><br><span class="line">docker stop &lt;name&gt;</span><br><span class="line">docker attach &lt;<span class="built_in">id</span>&gt;						<span class="comment">#进入后台运行（docker start -d）的容器</span></span><br><span class="line"><span class="comment">#如果是以attach进入，在exit时，会导致容器的停止，要保持后台运行，使用exec进入</span></span><br><span class="line">docker <span class="built_in">exec</span> &lt;<span class="built_in">id</span>&gt;						<span class="comment">#to know more, use: docker exec --help </span></span><br><span class="line"></span><br><span class="line">docker <span class="built_in">export</span> &lt;ID&gt; &gt; [name]</span><br><span class="line">docker <span class="built_in">export</span> 1eee1e1e1e1f &gt; alpine.tar		<span class="comment">#导出容器快照到本地文件alpine.tar</span></span><br><span class="line"><span class="built_in">cat</span> docker/alpine.tar | docker import - <span class="built_in">test</span>/alpine:v1</span><br><span class="line">docker import http://example.com/exampleimage.tgz example/imagerepo	<span class="comment">#导入</span></span><br><span class="line"></span><br><span class="line">docker top &lt;container <span class="built_in">id</span>&gt;			</span><br><span class="line">docker top &lt;container names&gt;			<span class="comment">#查看容器进程</span></span><br><span class="line">docker inspect &lt;container <span class="built_in">id</span> or names&gt;	<span class="comment">#查看底层信息，配置、状态等，以json形式</span></span><br><span class="line"></span><br><span class="line">docker <span class="built_in">rm</span> &lt;<span class="built_in">id</span> or names&gt;</span><br><span class="line">docker container update --restart=&lt;strategy&gt; &lt;container name&gt;	<span class="comment">#重置重启策略</span></span><br></pre></td></tr></table></figure>



<h2 id="交互"><a href="#交互" class="headerlink" title="交互"></a>交互</h2><h3 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -P 与 -p ：-P :是容器内部端口**随机**映射到主机的端口。-p : 是容器内部端口绑定到**指定**的主机端口。</span></span><br><span class="line">docker run -d -p 5000:5000 --name [name] [repository] [<span class="built_in">command</span>]</span><br></pre></td></tr></table></figure>

<h3 id="容器互联"><a href="#容器互联" class="headerlink" title="容器互联"></a>容器互联</h3><p>可以创建新的网络，令多个容器之间互联</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker network create -d bridge [net-name]</span><br><span class="line">docker run -itd --name [name1] --network [net-name] [image] /bin/bash</span><br><span class="line">docker run -itd --name [name2] --network [net-name] [image] /bin/bash</span><br><span class="line"><span class="comment"># 在name1内</span></span><br><span class="line">ping name2</span><br></pre></td></tr></table></figure>



<h2 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h2><p>Dockerfile 是一个用来构建镜像的文本文件，创建 dockerfile ，<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">官方文档</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM [base image]</span><br><span class="line">RUN	[command]</span><br></pre></td></tr></table></figure>

<p>构建镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f /path/dockerfile</span><br></pre></td></tr></table></figure>



<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.docker.com/">docker 官网</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/">docker 文档</a></p>
<p><a target="_blank" rel="noopener" href="http://www.docker.org.cn/">docker 中文网站</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/desktop/">docker manuals</a></p>
<p><a target="_blank" rel="noopener" href="http://www.yunweipai.com/docker%e6%95%99%e7%a8%8b">运维派docker</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">dockerfile reference</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/09/28/docker%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/" data-id="clehgxuvz0018d9p3bpeebbyt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/09/28/docker%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          docker数据持久化
        
      </div>
    </a>
  
  
    <a href="/2021/09/15/Hexo-icarus%E4%B8%BB%E9%A2%98%E9%BB%91%E5%A4%9C%E6%A8%A1%E5%BC%8F%E4%BB%A5%E5%8F%8A%E8%83%8C%E6%99%AF/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hexo-icarus主题黑夜模式以及背景</div>
    </a>
  
</nav>

  
</article>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>